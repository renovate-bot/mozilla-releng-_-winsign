---
transforms:
  - taskgraph.transforms.matrix

task-defaults:
    worker-type: test
    worker:
        max-run-time: 1800
    run:
        using: run-task

tasks:
    tox:
        matrix:
            python: ["311", "312", "313", "314"]
            os: [deb12, deb13]
        description: unit tests on python {matrix[python]}
        run:
            command: ['uvx', '--with', 'tox-uv', 'tox', '-e', 'py{matrix[python]},report']
            cwd: '{{checkout}}'
        worker:
            docker-image: {in-tree: 'tox-{matrix[os]}'}

    check:
        description: code linting
        run:
            command: ['uvx', '--with', 'tox-uv', 'tox', '-e', 'check']
            cwd: '{checkout}'
        worker:
            docker-image: {in-tree: tox-deb12}
